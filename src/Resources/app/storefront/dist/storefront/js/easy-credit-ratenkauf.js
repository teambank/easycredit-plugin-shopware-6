"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["easy-credit-ratenkauf"],{6247:(e,t,r)=>{var i=r(6285);const n=async()=>{let e;if(void 0===window.csrf)return;let t=window.csrf;return"1"===t.enabled&&"ajax"===t.mode&&(e=await fetch(window.router["frontend.csrf.generateToken"],{method:"POST",headers:new Headers({"content-type":"application/json"})}).then((e=>e.json())).then((e=>e.token))),e},a=(e,t)=>{var r=document.createElement("input");return r.setAttribute("type","hidden"),r.setAttribute("name",e),r.setAttribute("value",t),r};class s extends i.Z{init(){document.querySelector("easycredit-checkout")&&document.querySelector("easycredit-checkout").addEventListener("submit",(async e=>{var t=document.getElementById("changePaymentForm");let r=await n();return r&&t.append(a("_csrf_token",r)),t.append(a("easycredit[submit]","1")),t.append(a("easycredit[number-of-installments]",e.detail.numberOfInstallments)),t.submit(),!1}))}}class c extends i.Z{init(){this.el.addEventListener("submit",(async()=>{var e;(e=await this.replicateBuyForm())?e.submit():document.querySelector(".is-ctl-checkout.is-act-cartpage")||this.el.closest(".cart-offcanvas")?window.location.href="/easycredit/express":alert("Der easycredit-Ratenkauf konnte nicht gestartet werden.")}))}async replicateBuyForm(){let e=document.getElementById("productDetailPageBuyProductForm");if(!e)return!1;var t=document.createElement("form");t.setAttribute("action",e.getAttribute("action")),t.setAttribute("method","post"),t.style.display="none";var r=new FormData(e);for(var i of(r.set("redirectTo","frontend.easycredit.express"),r.set("easycredit-express","1"),r.keys())){let e=document.createElement("input");e.setAttribute("name",i),e.setAttribute("value",r.get(i)),t.append(e)}let s=await n();return s&&t.append(a("_csrf_token",s)),document.querySelector("body").append(t),t}}class o extends i.Z{init(){this.initWidget(document),this.registerOffCanvas()}registerOffCanvas(){let e=document.querySelector("[data-off-canvas-cart]");e&&window.PluginManager.getPluginInstanceFromElement(e,"OffCanvasCart").$emitter.subscribe("offCanvasOpened",this.onOffCanvasOpened.bind(this))}onOffCanvasOpened(){this.initWidget(document.querySelector("div.cart-offcanvas"))}initWidget(e){const t=this.getMeta("widget-selector",e);if(null===t)return;if(null===this.getMeta("api-key"))return;let r=this.processSelector(t);e.querySelectorAll(r.selector).forEach((t=>{this.applyWidget(e,t,r.attributes)}))}applyWidget(e,t,r){let i=this.getMeta("amount",e,t);if(null===i||isNaN(i)){const e=t.parentNode;i=e&&e.querySelector("[itemprop=price]")?e.querySelector("[itemprop=price]").content:null}if(null===i||isNaN(i))return;let n=document.createElement("easycredit-widget");if(n.setAttribute("webshop-id",this.getMeta("api-key")),n.setAttribute("amount",i),this.getMeta("disable-flexprice")?n.setAttribute("disable-flexprice","true"):n.removeAttribute("disable-flexprice"),r)for(const[e,t]of Object.entries(r))n.setAttribute(e,t);t.appendChild(n)}getMeta(e,t=null,r=null){let i;null===t&&(t=document);const n="meta[name=easycredit-"+e+"]";if(r){let e;if((e=r.closest(".cms-listing-col"))&&(i=e.querySelector(n)))return i.content}return(i=t.querySelector(n))?i.content:null}processSelector(e){let t;if(t=e.match(/(.+) easycredit-widget(\[.+?\])$/)){const e=t[2].split("]").map((e=>e.slice(1).split("="))).filter((([e,t])=>e)).reduce(((e,[t,r])=>({...e,[t]:r})),{});return{selector:t[1],attributes:e}}return{selector:e}}}class d extends i.Z{init(){this.initMarketing()}initMarketing(){if(this.body=document.querySelector("body"),this.bar=document.querySelector("easycredit-box-top"),this.bar&&this.body.classList.add("easycredit-box-top"),this.card=document.querySelector(".easycredit-box-listing"),this.card){var e=[...(n=this.card).parentElement.children].filter((e=>e!=n)),t=this.card.querySelector("easycredit-box-listing").getAttribute("position"),r=void 0===typeof t?null:Number(t-1),i=void 0===typeof t?null:Number(t-2);!t||r<=0||(i in e?e[i].after(this.card):this.card.parentElement.append(this.card))}var n}}PluginManager.register("EasyCreditRatenkaufCheckout",s,".is-ctl-checkout.is-act-confirmpage"),PluginManager.register("EasyCreditRatenkaufCheckoutExpress",c,"easycredit-express-button"),PluginManager.register("EasyCreditRatenkaufWidget",o,"body"),PluginManager.register("EasyCreditRatenkaufMarketing",d,"body")}},e=>{e.O(0,["vendor-node","vendor-shared"],(()=>{return t=6247,e(e.s=t);var t}));e.O()}]);