{% sw_extends '@Storefront/storefront/component/product/card/box-standard.html.twig' %}

{% block component_product_box_content %}

    {{ parent() }}

    {% set easycredit = (page ?? cmsPage).extensions.easycredit %}
    {% if easycredit.widgetEnabled and easycredit.apiKey %}

        {% set price = product.calculatedPrice %}
        {% if product.calculatedPrices.count > 0 %}
            {% set price = product.calculatedPrices.last %}
        {% endif %}
        {% set paymentTypes = easyCreditAvailablePaymentTypes(context, product) %}
        <script class="easycredit-config" type="application/json">{{ {
            'amount': price.unitPrice,
            'payment-types': paymentTypes,
            'disable-flexprice': easyCreditShouldDisableFlexprice(context, product)
        }|json_encode|raw }}</script>
    {% endif %}
{% endblock %}
